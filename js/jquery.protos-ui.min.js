(function(f,r,s){function l(a,b,c,d){a=f.extend(a,{author:b,widgetsName:d});b=new c(a);f.extend(b,g.widgets[d]);f.data(a.author[0],d,b);return b}var g=this.protos={},h=g.widgets={};f.fn.protos=function(){var a=this;return{popUp:function(b){return l(b,a,h.popUp,"popUp")},alertPopUp:function(b,c){"string"===typeof b?(c={},c.content=b):c=b;return l(c,a,h.alertPopUp,"alertPopUp")},swap:function(b){l(b,a,h.swap,"swap")},shake:function(b){return l(b,a,h.shake,"shake")},draggable:function(b){return l(b,
a,h.draggable,"draggable")},spa:function(b){return l(b,a,g.spa,"spa")},imageGallery:function(b){return l(b,a,h.imageGallery,"imageGallery")},listView:function(b){return l(b,a,h.listView,"listView")},scrollTo:function(b){return l(b,a,g.scrollTo,"scrollTo")}}};String.prototype.executeJavaScriptInTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var c=a.indexOf("#");b=a.lastIndexOf("#");for(var d=a.length,e=c;e<=b;e++)if(e=a.indexOf("#",e),-1!==e){var e=e+1,p=a.indexOf("#",e),c=a.substr(e,p-
e);a=a.substr(0,e-2)+a.substr(p+2,d);e-=2;eval(c)}else break;return a};String.prototype.displayStringsTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var c=a.indexOf("#=");b=a.lastIndexOf("#");for(var d=a.length;c<=b;c++)if(c=a.indexOf("#=",c),-1!==c){var c=c+2,e=a.indexOf("#",c),p=a.substr(c,e-c);a=a.substr(0,c-2)+eval(p)+a.substr(e+1,d);c-=2}else break;return a};String.prototype.format=function(){var a=this.match(/{[0-9]}/g),b=this,c;for(c in a)b=b.replace(a[c],arguments[c]);return b};
g.convertTemplateToString=function(a,b){var c=f(s+a),c=0!==c.length?c.html().displayStringsTemplate(b).executeJavaScriptInTemplate(b):a.displayStringsTemplate(b).executeJavaScriptInTemplate(b),d;for(d in b)delete window[d];return c};g.generateHTML=function(){var a=arguments,b={tag:a[0],classes:a[1],text:a[2],id:a[3],selfClosingTag:a[4],attributes:a[5]},b=f.extend({tag:"div",classes:[],text:"",id:""},b),c="",a=b.tag,c=c+("<"+a+" ");(function(){var a=b.id;c=a?c+('id="'+a+'" '):c+" "})();(function(){var a=
b.classes;0<a.length&&(c+='class="'+a.join(" ")+'"')})();(function(){var a=b.attributes,e;for(e in a)c+=e+'="'+a[e]+'" '})();b.selfClosingTag||(c+=">"+b.text);return c=!0===b.selfClosingTag?c+" />":c+("</"+a+">")};g.getElementOffset=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}};g.template=function(a,b){this.render=function(){return g.convertTemplateToString(a,b)};return this};
var t=navigator.productSub,u=navigator.platform,x=parseInt(u[u.length-1]),y=t[t.length-1];g.guid=function(){return"xxxxxxxx-sbxp-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xysbp]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:"s"===a?y:"p"===a?x:"b"===a?16*Math.random()|0:b&3|8).toString(16)})};g.queryStringToJson=function(a){var b={},c=a.indexOf("?");if(-1!==c){a=a.substr(c+1,a.length).split("&");for(var c=a.length,d=0;d<c;d++){var e=a[d].split("=");e[0]=decodeURIComponent(e[0]);e[1]=decodeURIComponent(e[1]);
"undefined"===typeof b[e[0]]?b[e[0]]=e[1]:"string"===typeof b[e[0]]?b[e[0]]=[b[e[0]],e[1]]:b[e[0]].push(e[1])}return b}};g.jsonToArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};g.routeToArray=function(a){if(a){var b=[];a=a.substr(1,a.length).split("/");for(var c in a){var d=a[c];d?b.push(d):d}return b}};g.deferred=function(){var a=[],b=[],c=this;c.resolve=function(){for(var b=arguments,e=0;e<a.length;e++)a[e](b);return c};c.reject=function(){for(var a=arguments,e=0;e<b.length;e++)b[e](a);
return c};c.done=function(b){a.push(b);return c};c.fail=function(a){b.push(a);return c}};g.deeplyDelete=function(a){for(var b in a)b instanceof Object&&this(a[b]),delete a[b]};g.qr=function(a,b,c){a="https://chart.googleapis.com/chart?cht=qr&chs={0}x{1}&chl={2}&chld={3}".format(b,b,a,c||"L");b=new Image;b.src=a;return b};g.dataSource=function(a){function b(a){for(var b in a){var c=a[b];c.uid=g.guid();c.changed=!1;c.savedChanges=!0;c.deleted=!1}}var c=this,d;c.items=function(){return d};c.server=a.server;
c.originalData=a.data||[];c.dataChanged=a.dataChanged||f.noop;c.filters=[];c._data=[];c.originalDataLength=c.originalData.length;c.data=[];c.read=function(b,d){var e={};if(d||0===c._data.length)e={page:b||0,itemsPerPage:d};e.filters=[];for(var k in c.filters){var v=c.filters[k];"function"!==typeof v&&e.filters.push(v)}var n=new g.deferred;if("function"===typeof a.data.read)return a.data.read(e),n.resolve();f.ajax({type:"json",url:c.originalData.read,contentType:"application/json; charset=utf-8",type:"GET",
dataType:"jsonp",data:e,success:function(a){c.readed(a);n.resolve()},error:function(a){n.reject()}});return n};c.readed=function(a){var e={},f;a.length?(d=a.length,e=a):(d=a.items,e=a.data,f=!0);b(e);c._data=e;return c.dataChanged(f)};var e=function(b){var c=new g.deferred;if("function"===typeof a.data.create)return a.data.create(b),c.resolve();f.ajax({url:a.data.create,data:{items:b}}).done(function(){c.resolve()});return c};c.created=function(a){b(a);c._data=c._data.concat(a);return c.dataChanged()};
c.update=function(b){var d=new g.deferred,e=function(a){return!a.savedChanges};b=b||c._data.where(e);if("function"===typeof a.data.update)return a.data.update(b),d.resolve();c._data.all(function(a){a.savedChanges=!0});f.ajax({url:a.data.update,data:{items:b}}).done(function(){c.updated();d.resolve()});return d};c.updated=function(a){for(var b=0;b<a.length;b++)a[b].savedChanges=!1;return c.dataChanged()};c["delete"]=function(b){var d=new g.deferred,e=function(a){return a.deleted};b=b||c._data.where(e);
if("function"===typeof a.data["delete"])return a.data["delete"](b),d.resolve();f.ajax({url:a.data.update,data:{items:b}}).done(function(){d.resolve()});return d};c.deleted=function(a){a=c._data;for(var b=a.length,d=0;d<b;d++){var e=a[d];e.deleted&&(g.deeplyDelete(e),a=a.splice(d,1))}return c.dataChanged()};c.originalData.read||c.readed(c.originalData);c.findItem=function(a){return c._data.first(function(b){return b.uid==a})};c.getPageData=function(a,b,e){var f=new g.deferred;if(!e&&c.originalData.read&&
!d)c.read(a-1,b).done(function(){f.resolve(c.data)});else if(d)return a=c._data.skip((a-1)*b).take(b),c.data=a;return f.reject()};c.addItems=function(a){e(a).done(function(){for(var b=a.length,d=0;d<b;d++){var e=a[d];e.uid=g.guid();e.changed=!1;e.savedChanges=!0;e.deleted=!1}c._data=c._data.concat(a);return c.dataChanged()})};c.addFilter=function(a){c.filters.push(a)};c.clearFilters=function(){c._data=c.originalData};c.sort=function(){};c.filter=function(a){var b=[];a|=NaN;var d=c.filters;c._data=
[];for(var e in d){var f=d[e];switch(f.operator){case "eq":var g="and"===a?c._data:c.originalData,w;for(w in g){var h=g[w],l;for(l in h)l==f.field&&h[l]==f.value&&b.push(h)}}c._data=c._data.concat(b);b=[]}};c.getOriginalData=function(){return c.originalData};c.set=function(a,b,c){a[b]=c;a.savedChanges=!1;return a};return c};g.draggable=function(a){var b,c,d=f(a.author.selector),e;a.moveParent&&a.isParentDraggable&&(d=f(a.moveParent));e=f(a.moveParent);d.on("mousedown",function(p){function q(a,b,c){var d=
{};b&&f.extend(d,{left:b+"px"});c&&f.extend(d,{top:c+"px"});a.css(d)}b=p.clientX-g.getElementOffset(this).left;c=p.clientY-g.getElementOffset(this).top;var m=a.container;if(m)f(r).on("mousemove",function(k){var p=k.clientX-b;k=k.clientY-c;var n=g.getElementOffset(f(m)[0]);m=f(a.container);if(n.left<p&&n.top<k){var h=g.getElementOffset(d[0]).left+d.outerWidth(),l=g.getElementOffset(d[0]).top+d.outerHeight(),r=n.left+m.outerWidth(),n=n.top+m.outerHeight(),s=r-d.outerWidth(),t=n-d.outerHeight()-1;h<=
r?q(e,p,""):q(e,s,"");l<n-1?q(e,"",k):q(e,"",t)}});else f(r).on("mousemove",function(a){var d=a.clientX-b;a=a.clientY-c;g.getElementOffset(f(m)[0]);q(e,d,a)});f(r).on("mouseup",function(){f(r).unbind("mousemove")})});return this};Array.prototype.where=function(a){for(var b=[],c=this.length,d=0;d<c;d++){var e=this[d];!0===a(e)&&b.push(e)}return b};Array.prototype.first=function(a){for(var b=this.length,c=0;c<b;c++){var d=this[c];if(!0===a(d))return d}};Array.prototype.sort=function(a){var b=this.length,
c=Math.floor(b/2);if(2>b)return this;for(var d=this.slice(0,c).sort(a),b=this.slice(c,b).sort(a),c=[];0<d.length||0<b.length;)0<d.length&&0<b.length?a(d[0],b[0])?(c.push(d[0]),d=d.slice(1)):(c.push(b[0]),b=b.slice(1)):0<d.length?(c.push(d[0]),d=d.slice(1)):0<b.length&&(c.push(b[0]),b=b.slice(1));return c};Array.prototype.last=function(a){for(var b=this.length,c,d=0;d<b;d++){var e=this[d];!0===a(e)&&(c=e)}return c};Array.prototype.any=function(a){for(var b=this.length,c=0;c<b;c++)if(!0===a(this[c]))return!0;
return!1};Array.prototype.all=function(a){for(var b=this.length,c=0;c<b;c++)a(this[c]);return this};Array.prototype.count=function(){return this.length-1};Array.prototype.skip||(Array.prototype.skip=function(a){if(this instanceof Array)return this.slice(a,this.length)});Array.prototype.take=function(a){if(this instanceof Array)return this.slice(0,a)};g.lazyLoading=function(a){var b={container:f()};a=f.extend(b,a);f(r).scroll(function(){var b=f(window).scrollTop(),d=f(r).height(),e=f(window).height();
.95<b/(d-e)&&a.container.trigger("lazyLoad")})};h.listView=function(a){var b=this,c=a.author[0],d=c.id+"_listItems",e=c.id+"pagerContainer";a=f.extend({width:600,height:400,imageWidth:200,pageSize:15,lazyLoading:!1},a);c.innerHTML=g.generateHTML("ul",[],"",d);f(c)[0].innerHTML+=g.generateHTML("div",[],"",e);b.dataSource=a.data;b.renderPage=function(){a.lazyLoading||f(s+d+" li").remove(".listViewItem");for(var e="",q=b.dataSource.data,m=0;m<q.length;m++)var k=(new g.template(a.templateId,q[m])).render(),
e=e+g.generateHTML("li",["listViewItem"],k,"",!1,{"data-uid":q[m].uid});f(s+d).append(e);f(c).trigger("pageRendered")};b.pager=new g.widgets.pager({pageSize:a.pageSize,dataSource:a.data,container:s+e,pageChanged:b.renderPage,lazyLoading:a.lazyLoading,nextPrevButtons:a.nextPrevButtons});b.pager.changePage(1);return b};h.pager=function(a){function b(){if(p){var b=a.dataSource.items(),c="",d=a.nextPrevButtons,b=Math.ceil(b/a.pageSize);d?c+=g.generateHTML("li",["pageNumber"],"<"):c;for(var e=0;e<b;e++)var q=
g.generateHTML("li",["pageNumber"],e+1),c=c+q;d?c+=g.generateHTML("li",["pageNumber"],">"):c;p[0].innerHTML=g.generateHTML("div",["pager"],g.generateHTML("ul",["pageList"],c));f(function(){f("li").on("click",p,function(){k(this.innerHTML)})})}}var c={pageSize:15,pageChanged:f.noop,nextPrevButtons:!0},d=this,e=1,p=f(a.container),q=a.dataSource;d.currentPage=function(){return parseInt(e)};a=f.extend(c,a);d.changePage=function(b,c){new g.deferred;var d;e=b;d=q.getPageData(b,a.pageSize,c);d instanceof
g.deferred?d.done(m):m(d)};d.refresh=function(a){b();d.changePage(e,a)};q.dataChanged=d.refresh;(function(){a.lazyLoading?(f(p).on("lazyLoad",function(){d.nextPage()}),lazyLoading=new g.lazyLoading({container:p})):b()})();var m=function(b){b[0]&&(f(a.container+" li").each(function(){this.innerHTML==e?f(this).addClass("selectedPage"):f(this).removeClass("selectedPage")}),p.trigger("pageChanged"),a.pageChanged())};d.nextPage=function(){k("&rt;")};d.prevPage=function(){k("&lt;")};var k=function(b){isNaN(parseInt(b))?
"&lt;"===b?(e--,1<=e?d.changePage(e):e++):(e++,e<=Math.ceil(q._data.length/a.pageSize)?d.changePage(e):e--):d.changePage(b)}};g.scrollTo=function(a){var b=a.author;a=a.speed||1E3;f(r.body).animate({scrollTop:g.getElementOffset(b[0]).top},a);return b};g.spa=function(a){var b=this;b.options=f.extend({},a);b.layout=b.options.author;b.routes=b.options.routes;b.startRouting=function(){c(window.location.hash);if("onhashchange"in window)window.onhashchange=function(){c(window.location.hash)};else{var a=
window.location.hash;window.setInterval(function(){window.location.hash!=a&&(a=window.location.hash,c(a))},100)}};b.stopRouting=function(){clearInterval(!0);window.onhashchange=f.noop};b.navigate=function(a){c("#"+a)};var c=function(a){for(var c in b.routes){var f=b.routes[c].route,m;1===a.indexOf("/")&&0===f.indexOf("/")?m=!1:m=!0;var k;k="#"+f;var h=a,n=m;if(k===h)k=!0;else{var l=k.match(RegExp(":[a-zA-Z0-9.\\-~_+%]+","g")),r=void 0;if(null===l)k=!1;else{r=n?g.jsonToArray(g.queryStringToJson(h)):
g.routeToArray(h);n=void 0;for(n in l)k=k.replace(l[n],r[n]);k=k===h}}if(k){c=b.routes[c].action;if("undefined"!==typeof c&&"function"===typeof c)return a=m?g.queryStringToJson(a):g.routeToArray(a),c(a||{});if("undefined"===typeof c)return d(f);if("string"===typeof c)return d(c);break}}},d=function(a){f.ajax({url:a,type:"html",method:"get"}).done(function(a){b.layout.html(a)})};return b};h.shake=function(a){var b=this,c=a.author,d=a.speed,e=-1*a.distance,f=a.vertical,g,h;c.on(a.event,function(){b.start()});
b.start=function(){c.trigger("shakingStarts");g=setInterval(function(){c.css({"-webkit-transform":"translate("+(f?0:e)+"px, "+(f?e:0)+"px)"});e*=-1},100*d);h=setTimeout(function(){c.css({"-webkit-transform":"translate(0px, 0px)"});b.stop()},a.duration);return b};this.stop=function(){clearInterval(g);clearTimeout(h)};return b};h.swap=function(a){var b=a.author,c=f(a.element),d=this;b.on(a.event,function(){d.start()});d.start=function(){b.trigger("swappingStarts");b.fadeOut(a.fadeOutSpeed);c.fadeIn(a.fadeInSpeed);
setTimeout(function(){b.trigger("swappingEnds")},a.fadeOutSpeed+a.fadeInSpeed)};return d};h.alertPopUp=function(a){var b={width:380,height:120,author:f(r),widgetName:"alertPopUp",darkness:.3,title:"JavaScript Alert",draggable:!0};a=f.extend(b,a);a.content+=g.generateHTML("div",[],g.generateHTML("button",["protosOKbutton"],"Ok",!1),!1,{style:"padding-top: 15px; text-align: center;"});var b=new h.popUpCore(a),c=a.author[0];b.hidePopUp=function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();f.removeData(c,
"alertPopUp")};f.data(c,"alertPopUp",b);f.data(c,"alertPopUp").show();f(".protosOKbutton").on("click",function(){f.data(c,"alertPopUp").hide()});return b};h.imageGallery=function(a){var b=this,c=0;b.images=a.images||[];b.dataSource=[];b.images instanceof g.dataSource&&(b.dataSource=b.images,b.images=b.dataSource.data);a=f.extend({width:1E3,height:500,darkness:.4,repeatImages:!0,images:[]},a);b.popUp=f(a.author).protos().popUp(a);var d={style:"width: "+a.width/2+"px"};b.popUp.contentHtml=g.generateHTML("img",
[],"","mainImage",!0,{style:"max-width: "+a.width+"px"})+g.generateHTML("div",[],"<b>></b>","nextImg",!1,d)+g.generateHTML("div",[],"<b><</b> ","prevImg",!1,d);var e=function(b){if(b){var c=b.url;f("#mainImage")[0].setAttribute("src",c);b.title?f(".p-popUpTitle").text(b.title):f(".p-popUpTitle").text(a.title)}};b.nextImage=function(){f(a.author[0]).trigger("nextImage");h(1);e(b.images[c]);f(a.author[0]).trigger("imageChanged")};b.previousImage=function(){f(a.author[0]).trigger("previousImage");h(-1);
e(b.images[c]);f(a.author[0]).trigger("imageChanged")};var h=function(d){var e=b.images.length-1;if(0>e)return!1;c+=d;if(c>e)return c=a.repeatImages?0:e,!1;if(0>c)return c=a.repeatImages?e:0,!1},l=b.popUp.show,m=b.popUp.hide;b.popUp.show=function(){l();e(b.images[0]);f("#nextImg").on("click",function(){b.nextImage()});f("#prevImg").on("click",function(){b.previousImage()});f("body").on("keydown",function(a){37==a.keyCode&&b.previousImage();39==a.keyCode&&b.nextImage()})};b.popUp.hide=function(){m();
f("#nextImg").off("click");f("#prevImg").off("click");f("body").off("keydown")};b.removeImages=function(){b.images=[]};b.addImages=function(a){a instanceof g.dataSource&&(b.images=a.data);if(0<a.length){for(var c in a)b.images.push(a[c]);e(b.images[0]);return b}"object"===typeof a&&b.images.push(a);e(b.images[0]);return b};b.changeImage=function(c){e(b.dataSource.findItem(c));f(a.author[0]).trigger("imageChanged")};return b};h.popUpCore=function(a){var b=!1,c=g.generateHTML,d=this;d.author=f(a.author.selector);
d.darkLayerHtml=c("div",["p-darkLayer"],"","",!1,{style:"background-color: rgba(0,0,0,"+a.darkness+")"});d.contentHtml=c("div",["p-popUpContent"],a.content);d.titleHtml=c("div",["p-popUpTitle"],a.title);d.closePopUpButtonHtml='<a href="#">'+c("div",["p-closePopUpButton"],"X")+"</a>";d.body=f("body");(function(){d.author.on({showPopUp:function(){b||(popUpObject=d.addElements(a.darkness),d.addStyles(a,popUpObject),e(d),b=!0)},hidePopUp:function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();b=
!1}})})();d.show=function(){d.author.trigger("showPopUp");d.body.on("keydown",function(a){27==a.keyCode&&d.hide()})};d.hide=function(){d.author.trigger("hidePopUp");d.body.off("keydown")};var e=function(){f("div.p-PopUp a").on("click",".p-closePopUpButton",function(){d.hide()});d.body.on("click",".p-darkLayer",function(){d.hide()})};d.addElements=function(){d.popUpHtml=g.generateHTML("div",["p-PopUp"],d.closePopUpButtonHtml+d.addTitle()+d.contentHtml);d.body.append(d.darkLayerHtml);d.body.append(d.popUpHtml);
d.makeTitleDraggable();return f(".p-PopUp","body")};d.addStyles=function(a,b){b.css({left:window.innerWidth/2-a.width/2+"px",top:window.innerHeight/2-a.height/2+"px",width:a.width+"px",height:a.height+"px",position:"fixed"});f(".p-popUpContent","div.p-PopUp").css({width:a.width+"px",height:a.height-50+"px","overflow-y":"auto","overflow-x":"auto"})};d.makeTitleDraggable=function(){a.title&&!0===a.draggable&&l({moveParent:".p-PopUp",isParentDraggable:!0===a.isContentDraggable?!0:!1},f(".p-popUpTitle"),
g.draggable,"draggable")};d.addTitle=function(){return a.title?d.titleHtml:""};return d};h.popUp=function(a){a=f.extend({width:500,height:300,darkness:.3,title:"Window",draggable:!0},a);return new h.popUpCore(a)}})(jQuery,document,"#");