(function(f,p,s){function n(a,b,c,d){a=f.extend(a,{author:b,widgetsName:d});b=new c(a);f.extend(b,g.widgets[d]);f.data(a.author[0],d,b);return b}var g=this.protos={},m=g.widgets={};f.fn.protos=function(){var a=this;return{popUp:function(b){return n(b,a,m.popUp,"popUp")},alertPopUp:function(b,c){"string"===typeof b?(c={},c.content=b):c=b;return n(c,a,m.alertPopUp,"alertPopUp")},swap:function(b){n(b,a,m.swap,"swap")},shake:function(b){return n(b,a,m.shake,"shake")},draggable:function(b){return n(b,
a,m.draggable,"draggable")},spa:function(b){return n(b,a,g.spa,"spa")},imageGallery:function(b){return n(b,a,m.imageGallery,"imageGallery")},listView:function(b){return n(b,a,m.listView,"listView")},scrollTo:function(b){return n(b,a,g.scrollTo,"scrollTo")}}};String.prototype.executeJavaScriptInTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var c=a.indexOf("#");b=a.lastIndexOf("#");for(var d=a.length,e=c;e<=b;e++)if(e=a.indexOf("#",e),-1!==e){var e=e+1,f=a.indexOf("#",e),c=a.substr(e,f-
e);a=a.substr(0,e-2)+a.substr(f+2,d);e-=2;eval(c)}else break;return a};String.prototype.displayStringsTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var c=a.indexOf("#=");b=a.lastIndexOf("#");for(var d=a.length;c<=b;c++)if(c=a.indexOf("#=",c),-1!==c){var c=c+2,e=a.indexOf("#",c),f=a.substr(c,e-c);a=a.substr(0,c-2)+eval(f)+a.substr(e+1,d);c-=2}else break;return a};String.prototype.format=function(){var a=this.match(/{[0-9]}/g),b=this,c;for(c in a)b=b.replace(a[c],arguments[c]);return b};
g.convertTemplateToString=function(a,b){var c=f(s+a),c=0!==c.length?c.html().displayStringsTemplate(b).executeJavaScriptInTemplate(b):a.displayStringsTemplate(b).executeJavaScriptInTemplate(b),d;for(d in b)delete window[d];return c};g.generateHTML=function(){var a=arguments,b={tag:a[0],classes:a[1],text:a[2],id:a[3],selfClosingTag:a[4],attributes:a[5]},b=f.extend({tag:"div",classes:[],text:"",id:""},b),c="",a=b.tag,c=c+("<"+a+" ");(function(){var a=b.id;c=a?c+('id="'+a+'" '):c+" "})();(function(){var a=
b.classes;0<a.length&&(c+='class="'+a.join(" ")+'"')})();(function(){var a=b.attributes,e;for(e in a)c+=e+'="'+a[e]+'" '})();b.selfClosingTag||(c+=">"+b.text);return c=!0===b.selfClosingTag?c+" />":c+("</"+a+">")};g.getElementOffset=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}};g.template=function(a,b){this.render=function(){return g.convertTemplateToString(a,b)};return this};
var u=navigator.appName,v=navigator.platform,w=parseInt(v[v.length-1]),x=u[u.length-3],y=u[u.length-2];g.guid=function(){return"xxxxxxxx-sbkp-4xxx-yxxx-kxxxxxxxxxxx".replace(/[xysbkp]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:"s"===a?x:"k"===a?y:"p"===a?w:"b"===a?16*Math.random()|0:b&3|8).toString(16)})};g.queryStringToJson=function(a){var b={},c=a.indexOf("?");if(-1!==c){a=a.substr(c+1,a.length).split("&");for(var c=a.length,d=0;d<c;d++){var e=a[d].split("=");e[0]=decodeURIComponent(e[0]);
e[1]=decodeURIComponent(e[1]);"undefined"===typeof b[e[0]]?b[e[0]]=e[1]:"string"===typeof b[e[0]]?b[e[0]]=[b[e[0]],e[1]]:b[e[0]].push(e[1])}return b}};g.jsonToArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};g.routeToArray=function(a){if(a){var b=[];a=a.substr(1,a.length).split("/");for(var c in a){var d=a[c];d?b.push(d):d}return b}};f.fn.serializeJson=function(){var a={},b=this.serializeArray();f.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),
a[this.name].push(this.value||"")):a[this.name]=this.value||""});return a};g.deferred=function(){var a=[],b=[],c=function(a,b){for(var c=0;c<a.length;c++)a[c].apply(void 0,b)},d=this;d.resolve=function(){c(a,Array.prototype.slice.call(arguments,0));return d};d.reject=function(){c(b,arguments);return d};d.done=function(b){a.push(b);return d};d.fail=function(a){b.push(a);return d}};g.deeplyDelete=function(a){for(var b in a)b instanceof Object&&this(a[b]),delete a[b]};g.qr=function(a,b,c){a="https://chart.googleapis.com/chart?cht=qr&chs={0}x{1}&chl={2}&chld={3}".format(b,
b,a,c||"L");b=new Image;b.src=a;return b};g.dataSource=function(a){a=a||{};var b=this,c,d=null,e;b.dataChanged=f.noop;b.localRepository=null;b.currentPageData=null;b._pageSize=15;var h=function(b,c,d){var e=typeof b,g=c;if("function"===e)b(c,d);else{var h={contentType:"application/json; charset=utf-8",dataType:"json",type:"GET"};"string"===e?h.url=b:h=f.extend(h,b);a.prepareData&&(c=a.prepareData(c));"aspnet"===a.data.type&&(c="GET"===h.type?f.param(c):JSON.stringify(c));h.data=c;h.success=function(a){d.resolve(a,
g)};h.error=function(a){d.reject(a,g)};f.ajax(h)}},q=function(){this.savedChanges=!1},l=function(a){for(var b=a.length-1;0<=b;--b){var c=a[b],d;for(d in c)c.watch(d,q);c.uid=g.guid();c.changed=!1;c.savedChanges=!0;c.deleted=!1}};b.read=function(k){var r=new g.deferred;r.fail(function(a){console.log(a)});r.done(function(a){e=k;a.Total?(d=a.Total,c=a.Data):c=a;l(c);b.localRepository=c;b.dataChanged(!0)});a.server&&a.server.paging&&(k=f.extend({Pagination:{Page:1,PageSize:b._pageSize}},k));h(a.data.read,
k,r);return r};b.itemsCount=function(){return null!==d?d:b.localRepository.length};b.update=function(){var d=new g.deferred,e=c.where(function(a){return!a.savedChanges}),f=a.data.update;d.done(function(a,c){for(var d=c.length-1;0<=d;--d)c[d].savedChanges=!0;b.dataChanged(!0)});if("function"===typeof f)return f(e,d),d;h(f,e,d);return d};b.create=function(d){var e=new g.deferred;e.done(function(a){a instanceof Array||(a=[a]);l(a);c=c.concat(a);b.refresh()});if(a.data.create){if("function"===typeof a.data.create)return a.data.create(d,
e),e;h(a.data.create,d,e);return e}e.resolve(d)};b["delete"]=function(){var d=new g.deferred,e=function(a){return a.deleted};d.done(function(){c=c.remove(e);b.refresh()});if(a.data["delete"])return h(a.data["delete"],c.where(e),d),d;d.resolve()};b.getPageData=function(c,d,e){return a.server&&a.server.paging?e?b.currentPageData=b.localRepository:b.read({Pagination:{Page:c,PageSize:d}}):b.currentPageData=b.localRepository.skip((c-1)*d).take(d)};b.refresh=function(){var d=a.server;if(d&&(d.filtering||
d.paging||d.sorting))return b.read(e),b;b.localRepository=c;b.dataChanged(!0);return b};b.filter=function(c){if(a.server&&a.server.filtering)return b.read({Filters:c})};b.sort=function(){};b.findItem=function(a){return c.first(function(b){return b.uid==a})};return b};g.draggable=function(a){var b,c,d=f(a.author.selector),e;a.moveParent&&a.isParentDraggable&&(d=f(a.moveParent));e=f(a.moveParent);d.on("mousedown",function(h){function q(a,b,c){var d={};b&&f.extend(d,{left:b+"px"});c&&f.extend(d,{top:c+
"px"});a.css(d)}b=h.clientX-g.getElementOffset(this).left;c=h.clientY-g.getElementOffset(this).top;var l=a.container;if(l)f(p).on("mousemove",function(k){var h=k.clientX-b;k=k.clientY-c;var t=g.getElementOffset(f(l)[0]);l=f(a.container);if(t.left<h&&t.top<k){var m=g.getElementOffset(d[0]).left+d.outerWidth(),z=g.getElementOffset(d[0]).top+d.outerHeight(),n=t.left+l.outerWidth(),t=t.top+l.outerHeight(),p=n-d.outerWidth(),s=t-d.outerHeight()-1;m<=n?q(e,h,""):q(e,p,"");z<t-1?q(e,"",k):q(e,"",s)}});else f(p).on("mousemove",
function(a){var d=a.clientX-b;a=a.clientY-c;g.getElementOffset(f(l)[0]);q(e,d,a)});f(p).on("mouseup",function(){f(p).unbind("mousemove")})});return this};g.formFiller=function(a,b){a=f(a);a.find("textarea").each(function(a,d){f(d).val(b[d.name])});a.find("select").each(function(a,d){var e=b[d.name];f(d).val(e)});a.find("input[type=radio]").each(function(a,d){var e=b[d.name];f(d).attr("data-finished",!0);e&&d.value==e&&f(d).attr("checked","checked")});a.find("input[type=checkbox]").each(function(a,
d){var e=b[d.name];f(d).attr("data-finished",!0);e&&-1!==e.indexOf(d.value)&&f(d).attr("checked","checked")});a.find("input[data-finished!=true]").each(function(a,d){var e=b[d.name];e&&f(d).val(e)})};Array.prototype.where=function(a){for(var b=[],c=this.length,d=0;d<c;d++){var e=this[d];!0===a(e)&&b.push(e)}return b};Array.prototype.first=function(a){for(var b=this.length,c=0;c<b;c++){var d=this[c];if(!0===a(d))return d}};Array.prototype.sort=function(a){var b=this.length,c=Math.floor(b/2);if(2>b)return this;
for(var d=this.slice(0,c).sort(a),b=this.slice(c,b).sort(a),c=[];0<d.length||0<b.length;)0<d.length&&0<b.length?a(d[0],b[0])?(c.push(d[0]),d=d.slice(1)):(c.push(b[0]),b=b.slice(1)):0<d.length?(c.push(d[0]),d=d.slice(1)):0<b.length&&(c.push(b[0]),b=b.slice(1));return c};Array.prototype.last=function(a){for(var b=this.length,c,d=0;d<b;d++){var e=this[d];!0===a(e)&&(c=e)}return c};Array.prototype.any=function(a){for(var b=this.length,c=0;c<b;c++)if(!0===a(this[c]))return!0;return!1};Array.prototype.all=
function(a){for(var b=this.length,c=0;c<b;c++)a(this[c]);return this};Array.prototype.count=function(){return this.length-1};Array.prototype.skip||(Array.prototype.skip=function(a){if(this instanceof Array)return this.slice(a,this.length)});Array.prototype.take=function(a){if(this instanceof Array)return this.slice(0,a)};Array.prototype.remove=function(a){for(var b=this.length-1,c=0;c<b;c++)!0===a(this[c])&&(this.splice(c,1),--c);return this};g.lazyLoading=function(a){var b={container:f()};a=f.extend(b,
a);f(p).scroll(function(){var b=f(window).scrollTop(),d=f(p).height(),e=f(window).height();.95<b/(d-e)&&a.container.trigger("lazyLoad")})};m.listView=function(a){var b=this,c=a.author[0]||{},d=c.id+"_listItems",e=c.id+"pagerContainer";a=f.extend({width:600,height:400,imageWidth:200,pageSize:15,lazyLoading:!1},a);c.innerHTML=g.generateHTML("ul",[],"",d);f(c)[0].innerHTML+=g.generateHTML("div",[],"",e);b.dataSource=a.data;var h=function(){var c=s+d+" li .";f(c+"itemEdit").each(function(d,c){f(c).on("click",
function(){var c=f(this).closest(".listViewItem"),d=c.attr("data-uid"),e=b.dataSource.findItem(d),h=c.data("popUp");h||(d=g.template(a.editTemplate).render(),d=g.generateHTML("form",[],d,"editForm"),c.protos().popUp(f.extend({content:d,title:"Edit item"},a.popUp||{})),h=c.data("popUp"));c.on("popUpShowed",function(){g.formFiller(f("#editForm"),e);f("#editForm").on("submit",function(a){a.preventDefault();f.extend(e,f("#editForm").serializeJson());h.hide();b.dataSource.update()})});h.show()})});f(c+
"itemDelete").each(function(a,c){f(c).on("click",function(){var a=f(this).closest(".listViewItem").attr("data-uid");b.dataSource.findItem(a).deleted=!0;b.dataSource["delete"]()})})};b.renderPage=function(){a.lazyLoading||f(s+d+" li").remove(".listViewItem");for(var e="",l=b.dataSource.currentPageData,k=0;k<l.length;k++)var r=(new g.template(a.templateId,l[k])).render(),e=e+g.generateHTML("li",["listViewItem"],r,"",!1,{"data-uid":l[k].uid});f(s+d).append(e);f(c).trigger("pageRendered");h()};b.pager=
new g.widgets.pager({pageSize:a.pageSize,dataSource:a.data,container:s+e,pageChanged:b.renderPage,lazyLoading:a.lazyLoading,nextPrevButtons:a.nextPrevButtons});a.data.read();return b};Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){c=d;d=e;b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}});Object.prototype.unwatch||
Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a];this[a]=b}});m.pager=function(a){function b(){if(h){var b=a.dataSource.itemsCount(),c="",d=a.nextPrevButtons,b=Math.ceil(b/a.pageSize);d?c+=g.generateHTML("li",["pageNumber"],"<"):c;for(var e=0;e<b;e++)var l=g.generateHTML("li",["pageNumber"],e+1),c=c+l;d?c+=g.generateHTML("li",["pageNumber"],">"):c;h[0].innerHTML=g.generateHTML("div",["pager"],g.generateHTML("ul",
["pageList"],c));f(function(){f("li").on("click",h,function(){k(this.innerHTML)})})}}var c={pageSize:15,pageChanged:f.noop,nextPrevButtons:!0},d=this,e=1,h=f(a.container),q=a.dataSource;d.currentPage=function(){return parseInt(e)};a=f.extend(c,a);var l=function(b){b[0]&&(f(a.container+" li").each(function(){this.innerHTML==e?f(this).addClass("selectedPage"):f(this).removeClass("selectedPage")}),h.trigger("pageChanged"),a.pageChanged())};d.changePage=function(b,c){new g.deferred;var d;e=b;d=q.getPageData(b,
a.pageSize,c);d instanceof g.deferred?d.done(l):l(d)};d.refresh=function(a){b();d.changePage(e,a)};q.dataChanged=d.refresh;(function(){a.lazyLoading&&(f(h).on("lazyLoad",function(){d.nextPage()}),lazyLoading=new g.lazyLoading({container:h}));q._pageSize=a.pageSize})();d.nextPage=function(){k("&rt;")};d.prevPage=function(){k("&lt;")};var k=function(b){var c=parseInt(b);isNaN(c)?"&lt;"===b?(e--,1<=e?d.changePage(e):e++):(e++,e<=Math.ceil(q.itemsCount()/a.pageSize)?d.changePage(e):e--):c!=e&&d.changePage(b)}};
g.scrollTo=function(a){var b=a.author;a=a.speed||1E3;f(p.body).animate({scrollTop:g.getElementOffset(b[0]).top},a);return b};g.spa=function(a){var b=this;b.options=f.extend({},a);b.layout=b.options.author;b.routes=b.options.routes;b.startRouting=function(){c(window.location.hash);if("onhashchange"in window)window.onhashchange=function(){c(window.location.hash)};else{var a=window.location.hash;window.setInterval(function(){window.location.hash!=a&&(a=window.location.hash,c(a))},100)}};b.stopRouting=
function(){clearInterval(!0);window.onhashchange=f.noop};b.navigate=function(a){c("#"+a)};var c=function(a){for(var c in b.routes){var f=b.routes[c].route,l;1===a.indexOf("/")&&0===f.indexOf("/")?l=!1:l=!0;var k;k="#"+f;var r=a,m=l;if(k===r)k=!0;else{var n=k.match(RegExp(":[a-zA-Z0-9.\\-~_+%]+","g")),p=void 0;if(null===n)k=!1;else{p=m?g.jsonToArray(g.queryStringToJson(r)):g.routeToArray(r);m=void 0;for(m in n)k=k.replace(n[m],p[m]);k=k===r}}if(k){c=b.routes[c].action;if("undefined"!==typeof c&&"function"===
typeof c)return a=l?g.queryStringToJson(a):g.routeToArray(a),c(a||{});if("undefined"===typeof c)return d(f);if("string"===typeof c)return d(c);break}}},d=function(a){f.ajax({url:a,type:"html",method:"get"}).done(function(a){b.layout.html(a)})};return b};m.shake=function(a){var b=this,c=a.author,d=a.speed,e=-1*a.distance,f=a.vertical,g,l;c.on(a.event,function(){b.start()});b.start=function(){c.trigger("shakingStarts");g=setInterval(function(){c.css({"-webkit-transform":"translate("+(f?0:e)+"px, "+
(f?e:0)+"px)"});e*=-1},100*d);l=setTimeout(function(){c.css({"-webkit-transform":"translate(0px, 0px)"});b.stop()},a.duration);return b};this.stop=function(){clearInterval(g);clearTimeout(l)};return b};m.swap=function(a){var b=a.author,c=f(a.element),d=this;b.on(a.event,function(){d.start()});d.start=function(){b.trigger("swappingStarts");b.fadeOut(a.fadeOutSpeed);c.fadeIn(a.fadeInSpeed);setTimeout(function(){b.trigger("swappingEnds")},a.fadeOutSpeed+a.fadeInSpeed)};return d};m.alertPopUp=function(a){var b=
{width:380,height:120,author:f(p),widgetName:"alertPopUp",darkness:.3,title:"JavaScript Alert",draggable:!0};a=f.extend(b,a);a.content+=g.generateHTML("div",[],g.generateHTML("button",["protosOKbutton"],"Ok",!1),!1,{style:"padding-top: 15px; text-align: center;"});var b=new m.popUpCore(a),c=a.author[0];b.hidePopUp=function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();f.removeData(c,"alertPopUp")};f.data(c,"alertPopUp",b);f.data(c,"alertPopUp").show();f(".protosOKbutton").on("click",function(){f.data(c,
"alertPopUp").hide()});return b};m.imageGallery=function(a){var b=this,c=0;b.images=a.images||[];b.dataSource=[];b.images instanceof g.dataSource&&(b.dataSource=b.images,b.images=b.dataSource.data);a=f.extend({width:1E3,height:500,darkness:.4,repeatImages:!0,images:[]},a);b.popUp=f(a.author).protos().popUp(a);var d={style:"width: "+a.width/2+"px"};b.popUp.contentHtml=g.generateHTML("img",[],"","mainImage",!0,{style:"max-width: "+a.width+"px"})+g.generateHTML("div",[],"<b>></b>","nextImg",!1,d)+g.generateHTML("div",
[],"<b><</b> ","prevImg",!1,d);var e=function(b){if(b){var c=b.url;f("#mainImage")[0].setAttribute("src",c);b.title?f(".p-popUpTitle").text(b.title):f(".p-popUpTitle").text(a.title)}};b.nextImage=function(){f(a.author[0]).trigger("nextImage");h(1);e(b.images[c]);f(a.author[0]).trigger("imageChanged")};b.previousImage=function(){f(a.author[0]).trigger("previousImage");h(-1);e(b.images[c]);f(a.author[0]).trigger("imageChanged")};var h=function(d){var e=b.images.length-1;if(0>e)return!1;c+=d;if(c>e)return c=
a.repeatImages?0:e,!1;if(0>c)return c=a.repeatImages?e:0,!1},m=b.popUp.show,l=b.popUp.hide;b.popUp.show=function(){m();e(b.images[0]);f("#nextImg").on("click",function(){b.nextImage()});f("#prevImg").on("click",function(){b.previousImage()});f("body").on("keydown",function(a){37==a.keyCode&&b.previousImage();39==a.keyCode&&b.nextImage()})};b.popUp.hide=function(){l();f("#nextImg").off("click");f("#prevImg").off("click");f("body").off("keydown")};b.removeImages=function(){b.images=[]};b.addImages=
function(a){a instanceof g.dataSource&&(b.images=a.data);if(0<a.length){for(var c in a)b.images.push(a[c]);e(b.images[0]);return b}"object"===typeof a&&b.images.push(a);e(b.images[0]);return b};b.changeImage=function(c){e(b.dataSource.findItem(c));f(a.author[0]).trigger("imageChanged")};return b};m.popUpCore=function(a){var b=!1,c=g.generateHTML,d=this;d.author=f(a.author);d.darkLayerHtml=c("div",["p-darkLayer"],"","",!1,{style:"background-color: rgba(0,0,0,"+a.darkness+")"});d.contentHtml=c("div",
["p-popUpContent"],a.content);d.titleHtml=c("div",["p-popUpTitle"],a.title);d.closePopUpButtonHtml='<a href="#">'+c("div",["p-closePopUpButton"],"X")+"</a>";d.body=f("body");(function(){d.author.on({showPopUp:function(){b||(popUpObject=d.addElements(a.darkness),d.addStyles(a,popUpObject),e(d),b=!0,d.author.trigger("popUpShowed"))},hidePopUp:function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();b=!1}})})();d.show=function(){d.author.trigger("showPopUp");d.body.on("keydown",function(a){27==a.keyCode&&
d.hide()})};d.hide=function(){d.author.trigger("hidePopUp");d.body.off("keydown")};var e=function(){f("div.p-PopUp a").on("click",".p-closePopUpButton",function(){d.hide()});d.body.on("click",".p-darkLayer",function(){d.hide()})};d.addElements=function(){d.popUpHtml=g.generateHTML("div",["p-PopUp"],d.closePopUpButtonHtml+d.addTitle()+d.contentHtml);d.body.append(d.darkLayerHtml);d.body.append(d.popUpHtml);d.makeTitleDraggable();return f(".p-PopUp","body")};d.addStyles=function(a,b){b.css({left:window.innerWidth/
2-a.width/2+"px",top:window.innerHeight/2-a.height/2+"px",width:a.width+"px",height:a.height+"px",position:"fixed"});f(".p-popUpContent","div.p-PopUp").css({width:a.width+"px",height:a.height-50+"px","overflow-y":"auto","overflow-x":"auto"})};d.makeTitleDraggable=function(){a.title&&!0===a.draggable&&n({moveParent:".p-PopUp",isParentDraggable:!0===a.isContentDraggable?!0:!1},f(".p-popUpTitle"),g.draggable,"draggable")};d.addTitle=function(){return a.title?d.titleHtml:""};return d};m.popUp=function(a){a=
f.extend({width:500,height:300,darkness:.3,title:"Window",draggable:!0},a);return new m.popUpCore(a)}})(jQuery,document,"#");